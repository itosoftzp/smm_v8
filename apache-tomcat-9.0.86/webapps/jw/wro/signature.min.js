
(function($){function SignaturePad(selector,options){var self=this,settings=$.extend({},$.fn.signaturePad.defaults,options),context=$(selector),canvas=$(settings.canvas,context),element=canvas.get(0),canvasContext=null,previous={'x':null,'y':null},output=[],mouseLeaveTimeout=false,mouseButtonDown=false,touchable=false,eventsBound=false,touchEventsBound=false,typeItDefaultFontSize=30,typeItCurrentFontSize=typeItDefaultFontSize,typeItNumChars=0
function clearMouseLeaveTimeout(){clearTimeout(mouseLeaveTimeout)
mouseLeaveTimeout=false
mouseButtonDown=false}
function drawLine(e,newYOffset){var offset,newX,newY
e.preventDefault()
offset=$(e.target).offset()
clearTimeout(mouseLeaveTimeout)
mouseLeaveTimeout=false
if(typeof e.targetTouches!=='undefined'){newX=Math.floor(e.targetTouches[0].pageX-offset.left)
newY=Math.floor(e.targetTouches[0].pageY-offset.top)}else{newX=Math.floor(e.pageX-offset.left)
newY=Math.floor(e.pageY-offset.top)}
if(previous.x===newX&&previous.y===newY)
return true
if(previous.x===null)
previous.x=newX
if(previous.y===null)
previous.y=newY
if(newYOffset)
newY+=newYOffset
canvasContext.beginPath()
canvasContext.moveTo(previous.x,previous.y)
canvasContext.lineTo(newX,newY)
canvasContext.lineCap=settings.penCap
canvasContext.stroke()
canvasContext.closePath()
output.push({'lx':newX,'ly':newY,'mx':previous.x,'my':previous.y})
previous.x=newX
previous.y=newY
if(settings.onDraw&&typeof settings.onDraw==='function')
settings.onDraw.apply(self)}
function stopDrawingWrapper(){stopDrawing()}
function stopDrawing(e){if(!!e){drawLine(e,1)}else{if(touchable){canvas.each(function(){this.removeEventListener('touchmove',drawLine)})}else{canvas.unbind('mousemove.signaturepad')}
if(output.length>0&&settings.onDrawEnd&&typeof settings.onDrawEnd==='function')
settings.onDrawEnd.apply(self)}
previous.x=null
previous.y=null
if(settings.output&&output.length>0)
$(settings.output,context).val(JSON.stringify(output))}
function drawSigLine(){if(!settings.lineWidth)
return false
canvasContext.beginPath()
canvasContext.lineWidth=settings.lineWidth
canvasContext.strokeStyle=settings.lineColour
canvasContext.moveTo(settings.lineMargin,settings.lineTop)
canvasContext.lineTo(element.width-settings.lineMargin,settings.lineTop)
canvasContext.stroke()
canvasContext.closePath()}
function clearCanvas(){canvasContext.clearRect(0,0,element.width,element.height)
canvasContext.fillStyle=settings.bgColour
canvasContext.fillRect(0,0,element.width,element.height)
if(!settings.displayOnly)
drawSigLine()
canvasContext.lineWidth=settings.penWidth
canvasContext.strokeStyle=settings.penColour
$(settings.output,context).val('')
output=[]
stopDrawing()}
function onMouseMove(e,o){if(previous.x==null){drawLine(e,1)}else{drawLine(e,o)}}
function startDrawing(e,touchObject){if(touchable){touchObject.addEventListener('touchmove',onMouseMove,false)}else{canvas.bind('mousemove.signaturepad',onMouseMove)}
drawLine(e,1)}
function disableCanvas(){eventsBound=false
touchEventsBound=false
canvas.each(function(){if(this.removeEventListener){this.removeEventListener('touchend',stopDrawingWrapper)
this.removeEventListener('touchcancel',stopDrawingWrapper)
this.removeEventListener('touchmove',drawLine)}
if(this.ontouchstart)
this.ontouchstart=null;})
$(document).unbind('mouseup.signaturepad')
canvas.unbind('mousedown.signaturepad')
canvas.unbind('mousemove.signaturepad')
canvas.unbind('mouseleave.signaturepad')
$(settings.clear,context).unbind('click.signaturepad')}
function initDrawEvents(e){$('input').blur();if(typeof e.targetTouches!=='undefined'){touchable=true}else{touchable=false}
if(touchable){if(touchEventsBound)
return false
touchEventsBound=true
canvas.each(function(){this.addEventListener('touchend',stopDrawingWrapper,false)
this.addEventListener('touchcancel',stopDrawingWrapper,false)})}else{if(eventsBound)
return false
eventsBound=true
$(document).bind('mouseup.signaturepad',function(){if(mouseButtonDown){stopDrawing()
clearMouseLeaveTimeout()}})
canvas.bind('mouseleave.signaturepad',function(e){if(mouseButtonDown)stopDrawing(e)
if(mouseButtonDown&&!mouseLeaveTimeout){mouseLeaveTimeout=setTimeout(function(){stopDrawing()
clearMouseLeaveTimeout()},500)}})
canvas.each(function(){this.ontouchstart=null})}}
function drawIt(){$(settings.typed,context).hide()
clearCanvas()
canvas.each(function(){this.addEventListener('touchstart',function(e){e.preventDefault()
mouseButtonDown=true
initDrawEvents(e)
startDrawing(e,this)})})
canvas.bind('mousedown.signaturepad',function(e){e.preventDefault()
if(e.which>1)return false
mouseButtonDown=true
initDrawEvents(e)
startDrawing(e)})
$(settings.clear,context).bind('click.signaturepad',function(e){e.preventDefault();clearCanvas()})
$(settings.typeIt,context).bind('click.signaturepad',function(e){e.preventDefault();typeIt()})
$(settings.drawIt,context).unbind('click.signaturepad')
$(settings.drawIt,context).bind('click.signaturepad',function(e){e.preventDefault()})
$(settings.typeIt,context).removeClass(settings.currentClass)
$(settings.drawIt,context).addClass(settings.currentClass)
$(settings.sig,context).addClass(settings.currentClass)
$(settings.typeItDesc,context).hide()
$(settings.drawItDesc,context).show()
$(settings.clear,context).show()}
function typeIt(){clearCanvas()
disableCanvas()
$(settings.typed,context).show()
$(settings.drawIt,context).bind('click.signaturepad',function(e){e.preventDefault();drawIt()})
$(settings.typeIt,context).unbind('click.signaturepad')
$(settings.typeIt,context).bind('click.signaturepad',function(e){e.preventDefault()})
$(settings.output,context).val('')
$(settings.drawIt,context).removeClass(settings.currentClass)
$(settings.typeIt,context).addClass(settings.currentClass)
$(settings.sig,context).removeClass(settings.currentClass)
$(settings.drawItDesc,context).hide()
$(settings.clear,context).hide()
$(settings.typeItDesc,context).show()
typeItCurrentFontSize=typeItDefaultFontSize=$(settings.typed,context).css('font-size').replace(/px/,'')}
function type(val){var typed=$(settings.typed,context),cleanedVal=$.trim(val.replace(/>/g,'&gt;').replace(/</g,'&lt;')),oldLength=typeItNumChars,edgeOffset=typeItCurrentFontSize*0.5
typeItNumChars=cleanedVal.length
typed.html(cleanedVal)
if(!cleanedVal){typed.css('font-size',typeItDefaultFontSize+'px')
return}
if(typeItNumChars>oldLength&&typed.outerWidth()>element.width){while(typed.outerWidth()>element.width){typeItCurrentFontSize--
typed.css('font-size',typeItCurrentFontSize+'px')}}
if(typeItNumChars<oldLength&&typed.outerWidth()+edgeOffset<element.width&&typeItCurrentFontSize<typeItDefaultFontSize){while(typed.outerWidth()+edgeOffset<element.width&&typeItCurrentFontSize<typeItDefaultFontSize){typeItCurrentFontSize++
typed.css('font-size',typeItCurrentFontSize+'px')}}}
function onBeforeValidate(context,settings){$('p.'+settings.errorClass,context).remove()
context.removeClass(settings.errorClass)
$('input, label',context).removeClass(settings.errorClass)}
function onFormError(errors,context,settings){if(errors.nameInvalid){context.prepend(['<p class="',settings.errorClass,'">',settings.errorMessage,'</p>'].join(''))
$(settings.name,context).focus()
$(settings.name,context).addClass(settings.errorClass)
$('label[for='+$(settings.name).attr('id')+']',context).addClass(settings.errorClass)}
if(errors.drawInvalid)
context.prepend(['<p class="',settings.errorClass,'">',settings.errorMessageDraw,'</p>'].join(''))}
function validateForm(){var valid=true,errors={drawInvalid:false,nameInvalid:false},onBeforeArguments=[context,settings],onErrorArguments=[errors,context,settings]
if(settings.onBeforeValidate&&typeof settings.onBeforeValidate==='function'){settings.onBeforeValidate.apply(self,onBeforeArguments)}else{onBeforeValidate.apply(self,onBeforeArguments)}
if(settings.drawOnly&&output.length<1){errors.drawInvalid=true
valid=false}
if($(settings.name,context).val()===''){errors.nameInvalid=true
valid=false}
if(settings.onFormError&&typeof settings.onFormError==='function'){settings.onFormError.apply(self,onErrorArguments)}else{onFormError.apply(self,onErrorArguments)}
return valid}
function drawSignature(paths,context,saveOutput){for(var i in paths){if(typeof paths[i]==='object'){context.beginPath()
context.moveTo(paths[i].mx,paths[i].my)
context.lineTo(paths[i].lx,paths[i].ly)
context.lineCap=settings.penCap
context.stroke()
context.closePath()
if(saveOutput&&paths[i].lx){output.push({'lx':paths[i].lx,'ly':paths[i].ly,'mx':paths[i].mx,'my':paths[i].my})}}}}
function init(){if(parseFloat(((/CPU.+OS ([0-9_]{3}).*AppleWebkit.*Mobile/i.exec(navigator.userAgent))||[0,'4_2'])[1].replace('_','.'))<4.1){$.fn.Oldoffset=$.fn.offset;$.fn.offset=function(){var result=$(this).Oldoffset()
result.top-=window.scrollY
result.left-=window.scrollX
return result}}
$(settings.typed,context).bind('selectstart.signaturepad',function(e){return $(e.target).is(':input')})
canvas.bind('selectstart.signaturepad',function(e){return $(e.target).is(':input')})
if(!element.getContext&&FlashCanvas)
FlashCanvas.initElement(element)
if(element.getContext){canvasContext=element.getContext('2d')
$(settings.sig,context).show()
if(!settings.displayOnly){if(!settings.drawOnly){$(settings.name,context).bind('keyup.signaturepad',function(){type($(this).val())})
$(settings.name,context).bind('blur.signaturepad',function(){type($(this).val())})
$(settings.drawIt,context).bind('click.signaturepad',function(e){e.preventDefault()
drawIt()})}
if(settings.drawOnly||settings.defaultAction==='drawIt'){drawIt()}else{typeIt()}
if(settings.validateFields){if($(selector).is('form')){$(selector).bind('submit.signaturepad',function(){return validateForm()})}else{$(selector).parents('form').bind('submit.signaturepad',function(){return validateForm()})}}
$(settings.sigNav,context).show()}}}
$.extend(self,{signaturePad:'{{version}}',init:function(){init()},updateOptions:function(options){$.extend(settings,options)},regenerate:function(paths){self.clearCanvas()
$(settings.typed,context).hide()
if(typeof paths==='string')
paths=JSON.parse(paths)
drawSignature(paths,canvasContext,true)
if(settings.output&&$(settings.output,context).length>0)
$(settings.output,context).val(JSON.stringify(output))},clearCanvas:function(){clearCanvas()},getSignature:function(){return output},getSignatureString:function(){return JSON.stringify(output)},getSignatureImage:function(){var tmpCanvas=document.createElement('canvas'),tmpContext=null,data=null
tmpCanvas.style.position='absolute'
tmpCanvas.style.top='-999em'
tmpCanvas.width=element.width
tmpCanvas.height=element.height
document.body.appendChild(tmpCanvas)
if(!tmpCanvas.getContext&&FlashCanvas)
FlashCanvas.initElement(tmpCanvas)
tmpContext=tmpCanvas.getContext('2d')
tmpContext.fillStyle=settings.bgColour
tmpContext.fillRect(0,0,element.width,element.height)
tmpContext.lineWidth=settings.penWidth
tmpContext.strokeStyle=settings.penColour
drawSignature(output,tmpContext)
data=tmpCanvas.toDataURL.apply(tmpCanvas,arguments)
document.body.removeChild(tmpCanvas)
tmpCanvas=null
return data},validateForm:function(){return validateForm()}})}
$.fn.signaturePad=function(options){var api=null
this.each(function(){if(!$.data(this,'plugin-signaturePad')){api=new SignaturePad(this,options)
api.init()
$.data(this,'plugin-signaturePad',api)}else{api=$.data(this,'plugin-signaturePad')
api.updateOptions(options)}})
return api}
$.fn.signaturePad.defaults={defaultAction:'typeIt',displayOnly:false,drawOnly:false,canvas:'canvas',sig:'.sig',sigNav:'.sigNav',bgColour:'#ffffff',penColour:'#145394',penWidth:2,penCap:'round',lineColour:'#ccc',lineWidth:2,lineMargin:5,lineTop:35,name:'.name',typed:'.typed',clear:'.clearButton',typeIt:'.typeIt a',drawIt:'.drawIt a',typeItDesc:'.typeItDesc',drawItDesc:'.drawItDesc',output:'.output',currentClass:'current',validateFields:true,errorClass:'error',errorMessage:'Please enter your name',errorMessageDraw:'Please sign the document',onBeforeValidate:null,onFormError:null,onDraw:null,onDrawEnd:null}}(jQuery));

if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());

!function(e){function l(e){var l,r,c;return this.length?((l=this[0]).ownerDocument?c=l.ownerDocument:l=(c=l).documentElement,null==e?c.exitFullscreen||c.webkitExitFullscreen||c.webkitCancelFullScreen||c.msExitFullscreen||c.mozCancelFullScreen?(e=n(c))&&(c.fullscreenElement||c.webkitFullscreenElement||c.webkitCurrentFullScreenElement||c.msFullscreenElement||c.mozFullScreenElement)||e:null:e?((r=l.requestFullscreen||l.webkitRequestFullscreen||l.webkitRequestFullScreen||l.msRequestFullscreen||l.mozRequestFullScreen)&&r.call(l),this):((r=c.exitFullscreen||c.webkitExitFullscreen||c.webkitCancelFullScreen||c.msExitFullscreen||c.mozCancelFullScreen)&&n(c)&&r.call(c),this)):this}function n(e){return!!(e.fullscreenElement||e.msFullscreenElement||e.webkitIsFullScreen||e.mozFullScreen)}function r(l){e(document).trigger(new e.Event("fullscreenchange"))}function c(l){e(document).trigger(new e.Event("fullscreenerror"))}var u,t,s;e.fn.fullScreen=l,e.fn.toggleFullScreen=function(){return l.call(this,!l.call(this))},(u=document).webkitCancelFullScreen?(t="webkitfullscreenchange",s="webkitfullscreenerror"):u.msExitFullscreen?(t="MSFullscreenChange",s="MSFullscreenError"):u.mozCancelFullScreen?(t="mozfullscreenchange",s="mozfullscreenerror"):(t="fullscreenchange",s="fullscreenerror"),e(document).bind(t,r),e(document).bind(s,c)}(jQuery);

(function($){$.fn.extend({signaturePadFullscreen:function(o){var target=this;var signaturePad=$(target).signaturePad(o);var canvas=$(target).find('.pad')[0];var paths=signaturePad.getSignature();var prevCanvasWidth=canvas.width;var prevCanvasHeight=canvas.height;var aspectRatio=canvas.width/canvas.height;$(target).find('.clearButton').on('mousedown click',function(){signaturePad.clearCanvas();paths=signaturePad.getSignature();});$(target).find('.fullscreenButton').on('mousedown click',function(event){if(document.fullscreenEnabled){if(!$(target).fullScreen()){paths=signaturePad.getSignature();$(target).addClass("fullscreen-active");$(target).fullScreen(true);return false;}else{paths=signaturePad.getSignature();$(target).fullScreen(false);return false;}}
else{if($(target).hasClass("fullscreen")){paths=signaturePad.getSignature();$(target).removeClass("fullscreen")
handleFullscreenChange()}else{paths=signaturePad.getSignature();$(target).addClass("fullscreen")
handleFullscreenChange()}}});function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args);};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args);};}
$(window).on("resize",debounce(function(event){handleFullscreenChange();},100));$(target).bind("fullscreenchange",handleFullscreenChange);function handleFullscreenChange(){var element=$(target);var button=element.find(".fullscreenButton");var canvas=element.find(".pad");if($(target).fullScreen()||$(target).hasClass("fullscreen")){if(element.width()/element.height()>aspectRatio){canvas.attr("width",element.height()*aspectRatio);canvas.attr("height",element.height());}else{canvas.attr("height",element.width()/aspectRatio);canvas.attr("width",element.width());}
paths=signaturePad.getSignature();paths=scaleCanvas(paths);signaturePad.clearCanvas();signaturePad.regenerate(paths);button.html('<i class="fas fa-compress-arrows-alt"></i>');}else{canvas.attr("width",o.width);canvas.attr("height",o.height);paths=signaturePad.getSignature();paths=scaleCanvas(paths);signaturePad.clearCanvas();signaturePad.regenerate(paths);$(target).removeClass("fullscreen-active");button.html('<i class="fas fa-expand-arrows-alt"></i>');}
paths=signaturePad.getSignature();};function scaleCanvas(pathArray){signaturePad.clearCanvas();if(pathArray.length>0){for(const data of pathArray){data.lx*=canvas.width/prevCanvasWidth;data.ly*=canvas.height/prevCanvasHeight;data.mx*=canvas.width/prevCanvasWidth;data.my*=canvas.height/prevCanvasHeight;}}
prevCanvasWidth=canvas.width;prevCanvasHeight=canvas.height;return pathArray;}
return signaturePad;}});})(jQuery);
